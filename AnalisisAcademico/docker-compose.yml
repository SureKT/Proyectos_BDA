services:
  # 1. Servicio de Apache NiFi (CORREGIDO)
  nifi:
    image: apache/nifi:2.6.0
    container_name: nifi
    hostname: nifi
    ports:
      - "8443:8443"
    environment:
      NIFI_WEB_HTTPS_PORT: "8443"
      NIFI_WEB_HTTP_PORT: ""
      NIFI_SENSITIVE_PROPS_KEY: "MiClaveSegura"
      SINGLE_USER_CREDENTIALS_USERNAME: admin
      SINGLE_USER_CREDENTIALS_PASSWORD: nifinifinifi
    volumes:
      # Mapear TODOS los directorios que NiFi necesita
      # - ./nifi/conf:/opt/nifi/nifi-current/conf
      - ./nifi/state:/opt/nifi/nifi-current/state
      - ./nifi/flowfile_repository:/opt/nifi/nifi-current/flowfile_repository
      - ./nifi/content_repository:/opt/nifi/nifi-current/content_repository
      - ./nifi/database_repository:/opt/nifi/nifi-current/database_repository
      - ./nifi/provenance_repository:/opt/nifi/nifi-current/provenance_repository
      - ./nifi/logs:/opt/nifi/nifi-current/logs
      # Carpetas de input/output para los ejercicios prácticos
      - ./nifi/data/input:/opt/nifi/input
      - ./nifi/data/output:/opt/nifi/output
    networks:
      - nifi-network

  # 2. Servicio de NiFi Registry CON PERSISTENCIA
  nifi-registry:
    image: apache/nifi-registry:2.6.0
    container_name: nifi-registry
    ports:
      - "18080:18080"
    environment:
      NIFI_REGISTRY_WEB_HTTP_PORT: 18080
    volumes:
      # Volúmenes para persistencia de configuración y almacenamiento de flujos
      # - ./nifi-registry/conf:/opt/nifi-registry/nifi-registry-current/conf
      - ./nifi-registry/flow_storage:/opt/nifi-registry/nifi-registry-current/flow_storage
      - ./nifi-registry/database:/opt/nifi-registry/nifi-registry-current/database
    networks:
      - nifi-network

networks:
  nifi-network:
    driver: bridge



